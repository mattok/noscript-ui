!function(t){"use strict";var e={const:{"resource-types":{script:"Scripts",media:"Images, videos, etc.",webgl:"Webgl",font:"Fonts",frames:"Frames",other:"Other things, such as ..."},"access-types":{"site-allow":{description:"Active for this site",style:"info"},"global-allow":{description:"Active anywhere",style:"info"},"site-deny":{description:"Blocked for this site",style:"danger"},"global-deny":{description:"Blocked everywhere",style:"danger"}},"url-component-types":{scheme:"The URL scheme e.g. http, https, ftp, etc.",username:"The URL username, if any. e.g. user in https://user@example.org/",domain:"The domain, (if not an IP). e.g. example.org in https://sub.domain.example.org/",subdomain:"The subdmain (if not an IP). e.g. sub.domain in https://sub.domain.example.org",ip:"The ip (if not a domain). e.g. 234.234.234.234 in https://234.234.234.234/",port:"The port, if any is made explicit. e.g. 8080 in https://example.org:8080/"}},config:{"default-components":["scheme","username","ip","subdomain","domain","port"],policy:{sites:{},global:{}}},session:{},method:{ForgetRule:function(t){var n=$(t).parents(".noscript-categorised-item");return $('.noscript-types input[type="checkbox"]:not(:disabled):checked',n).each(function(){var t=$(this).data();if(!(t.category in e.config.policy))return console.log("Expecting to find category: "+t.category+" in policy, but didn't."),!1;var n=e.config.policy[t.category];if(!(t.primaryUrl in n))return console.log("Expecting to find primary-url: "+t.category+"."+t.primaryUrl+" in policy, but didn't."),!1;var s,a=n[t.primaryUrl];if("secondaryUrl"in t){if(!(t.secondaryUrl in a))return console.log("Expecting to find secondary-url: "+t.category+"."+t.primaryUrl+"."+t.secondaryUrl+" in policy, but didn't."),!1;if(s=a[t.secondaryUrl],!(t.type in s))return console.log("Expecting to find type: "+t.category+"."+t.primaryUrl+("secondaryUrl"in t?"."+t.secondaryUrl:"")+"."+t.type+" in policy, but didn't."),!1;delete e.config.policy[t.category][t.primaryUrl][t.secondaryUrl][t.type],0==Object.keys(e.config.policy[t.category][t.primaryUrl][t.secondaryUrl]).length&&delete e.config.policy[t.category][t.primaryUrl][t.secondaryUrl],0==Object.keys(e.config.policy[t.category][t.primaryUrl]).length&&delete e.config.policy[t.category][t.primaryUrl]}else{if(s=a,!(t.type in s))return console.log("Expecting to find type: "+t.category+"."+t.primaryUrl+("secondaryUrl"in t?"."+t.secondaryUrl:"")+"."+t.type+" in policy, but didn't."),!1;delete e.config.policy[t.category][t.primaryUrl][t.type],0==Object.keys(e.config.policy[t.category][t.primaryUrl]).length&&delete e.config.policy[t.category][t.primaryUrl]}}),!0},URLComponents:function(t){var e=t.includes("://")?t:"://"+t,n=new URI(e),s=[];return n.scheme().length>0&&s.push("scheme"),n.username().length>0&&s.push("username"),n.is("IP")?n.hostname().length>0&&s.push("ip"):(n.subdomain().length>0&&s.push("subdomain"),n.domain().length>0&&s.push("domain")),n.port().length>0&&s.push("port"),s},RuleFromComponents:function(t,e){var n=URI(t.includes("://")?t:"://"+t),s="";if(-1!==e.indexOf("scheme")){var a=n.scheme();a.length>0&&(s+=a+"://")}if(-1!==e.indexOf("username")){var o=n.username();o.length>0&&(s+=o+"@")}if(n.is("IP")){if(-1!==e.indexOf("ip")){var r=n.hostname();r.length>0&&(s+=r)}}else{if(-1!==e.indexOf("subdomain")){var i=n.subdomain();i.length>0&&(s+=i+".")}if(-1!==e.indexOf("domain")){var l=n.domain();l.length>0&&(s+=l)}}if(-1!==e.indexOf("port")){var c=n.port();c.length>0&&(s+=":"+c)}return s},MatchRuleToUrl:function(t,e){var n=t.includes("://")?t:"://"+t,s=e.includes("://")?e:"://"+e,a=new URI(n),o=new URI(s),r=!1,i=a.scheme();if(i.length>0){var l=o.scheme();if(""==l||l!=i)return!1;r=!0}var c=a.username();if(c.length>0){var d=o.username();if(""==d||d!=c)return!1;r=!0}var p=a.password();if(p.length>0){var u=o.password();if(""==u||u!=p)return!1;r=!0}if(a.is("IP")&&o.is("IP")){var m=a.hostname();if(m.length>0){var h=o.hostname();if(""==h||h!=m)return!1;r=!0}}else if(!a.is("IP")&&!o.is("IP")){var b=a.domain();if(b.length>0){var y=o.domain();if(""==y||y!=b)return!1;r=!0}var g=a.subdomain();if(g.length>0){var f=o.subdomain();if(""==f||f!=g)return!1;r=!0}}var v=a.port();if(v.length>0){var $=o.port();if(""==$||$!=v)return!1;r=!0}return r},Categorise:function(t,n){for(var s={"global-deny":{},"site-deny":{},"global-allow":{},"site-allow":{},uncategorised:{}},a=n.length,o=0;o<a;o++){var r=n[o],i=!1,l=e.config.policy.global;for(var c in l){var d=l[c];for(var p in d)if(p==r.type&&e.method.MatchRuleToUrl(c,r.url)){var u=d[p]?"global-allow":"global-deny";r.url in s[u]||(s[u][r.url]={}),s[u][r.url][r.type]={category:"global","primary-url":c,type:p},i=!0;break}if(i)break}if(!i){var m=e.config.policy.sites;for(var c in m)if(e.method.MatchRuleToUrl(c,t)){var h=m[c];for(var b in h){d=h[b];for(var p in d)if(p==r.type&&e.method.MatchRuleToUrl(b,r.url)){u=d[p]?"site-allow":"site-deny";r.url in s[u]||(s[u][r.url]={}),s[u][r.url][r.type]={category:"sites","primary-url":c,"secondary-url":b,type:p},i=!0;break}if(i)break}if(i)break}i||(r.url in s.uncategorised||(s.uncategorised[r.url]={}),s.uncategorised[r.url][r.type]=!0)}}return s},GetInitialComponents:function(t){for(var n=e.method.URLComponents(t),s=[],a=e.config["default-components"].length,o=0;o<a;o++){var r=e.config["default-components"][o];-1!=n.indexOf(r)&&s.push(r)}return s.length>0?s:n}},tpl:{InputChecked:class extends nano.tpl{html(){return this.data?nano.html`checked="checked"`:""}},InputDisabled:class extends nano.tpl{html(){return this.data?nano.html`disabled="disabled"`:""}},RuleAttributes:class extends nano.tpl{html(){return this.data?nano.html`data-category="${this.data.category}" data-primary-url="${this.data["primary-url"]}" data-type="${this.data.type}"`+("secondary-url"in this.data?nano.html` data-secondary-url="${this.data["secondary-url"]}"`:""):""}},UncategorisedTypes:class extends nano.tpl{html(){var t="";for(var n in e.const["resource-types"]){var s=n in this.data.types&&this.data.types[n],a=!1;if(!s){var o=e.method.Categorise(e.session["current-url"],[{type:n,url:this.data.url}]);(Object.keys(o["global-allow"]).length>0||Object.keys(o["global-deny"]).length>0||Object.keys(o["site-allow"]).length>0||Object.keys(o["site-deny"]).length>0)&&(a=!0)}t+=nano.html`
  <label class="custom-control custom-checkbox ${s?"border border-warning rounded":""}" title="${e.const["resource-types"][n]}">
    <input data-type="${n}" class="custom-control-input" type="checkbox" ${new e.tpl.InputChecked(s)} ${new e.tpl.InputDisabled(a)}>
    <span class="custom-control-indicator m-1"></span>
    <span class="custom-control-description m-1">${n}</span>
  </label>
  `}return t}},UncategorisedItems:class extends nano.tpl{html(){var t="",n=0;for(var s in this.data.categories.uncategorised){n++;var a={url:s,types:this.data.categories.uncategorised[s]},o={url:s,"url-components":e.session["secondary-site-components"][s]};t+=nano.html`
  <li class="list-group-item list-group-item-action noscript-uncategorised-item" data-url="${s}" >
    <div class="row">
      <div class="col-12 mb-1 col-md-6 mb-md-0">
        <button class="btn btn-outline-primary btn-sm mr-1" type="button" data-toggle="collapse" data-target="#noscript-uncategorised-types-${n}" aria-expanded="false" aria-controls="noscript-uncategorised-types-${n}">+</button>
        <span class="noscript-secondary-rule" data-url="${s}">${new e.tpl.URLRuleSelector(o)}</span>
      </div>
      <div id="noscript-uncategorised-types-${n}" class="col-12 mb-1 collapse noscript-types">
        <div class="form-inline justify-content-start">
          ${new e.tpl.UncategorisedTypes(a)}
        </div>
      </div>
      <div class="col-12 mb-1 float-md-right">
        <div class="btn-toolbar noscript-toolbar justify-content-end" aria-label="Allow/Block toolbar" role="toolbar">
          <div class="btn-group mr-1 mb-1" role="group" aria-label="Allow group">
            <span class="btn btn-outline-info btn-sm disabled">
              Allow
            </span>
            <button class="btn btn-info btn-sm" type="button" data-access="sites" data-action="allow">
              for site
            </button>
            <span class="btn btn-outline-info btn-sm disabled">
              or
            </span>
            <button class="btn btn-info btn-sm font-weight-bold" type="button" data-access="global" data-action="allow">
              anywhere
            </button>
          </div>
          <div class="btn-group mb-1" role="group" aria-label="Block group">
            <span class="btn btn-outline-danger btn-sm disabled">
              Block
            </span>
            <button class="btn btn-danger btn-sm" type="button" data-access="sites" data-action="deny">
              for site
            </button>
            <span class="btn btn-outline-danger btn-sm disabled">
              or
            </span>
            <button class="btn btn-danger btn-sm font-weight-bold" type="button" data-access="global" data-action="deny">
              everywhere
            </button>
          </div>
        </div>
      </div>
    </div>
  </li>
  `}return t}},CategorisedTypes:class extends nano.tpl{html(){var t="";for(var n in e.const["resource-types"]){var s=n in this.data.types,a=n in this.data.types?this.data.types[n]:null;t+=nano.html`
  <label class="custom-control custom-checkbox ${s?"border border-"+this.data.style+" rounded":""}" title="${e.const["resource-types"][n]}">
    <input class="custom-control-input" type="checkbox" ${new e.tpl.InputChecked(s)} ${new e.tpl.InputDisabled(!s)} ${new e.tpl.RuleAttributes(a)} >
    <span class="custom-control-indicator m-1"></span>
    <span class="custom-control-description m-1">${n}</span>
  </label>
  `}return t}},CategorisedItems:class extends nano.tpl{html(){var t="",n=0;for(var s in this.data.urls){n++;var a={style:this.data.style,types:this.data.urls[s]};t+=nano.html`
  <li class="list-group-item list-group-item-action noscript-categorised-item" >
    <div class="d-flex justify-content-between">
      <div><button class="btn btn-outline-primary btn-sm mr-1" type="button" data-toggle="collapse" data-target="#noscript-${this.data["access-type"]}-${n}" aria-expanded="false" aria-controls="noscript-${this.data["access-type"]}-${n}">+</button>${s}</div>
      <div class="noscript-toolbar">
        <button class="btn btn-primary btn-sm" type="submit" data-url="${s}">Forget Rule</button>
      </div>
    </div>
    <div id="noscript-${this.data["access-type"]}-${n}" class="collapse mt-1 noscript-types">
      ${new e.tpl.CategorisedTypes(a)}
    </div>
  </li>
  `}return t}},URLRuleSelectorScheme:class extends nano.tpl{html(){return this.data.scheme.length>0?nano.html`
<label class="btn btn-outline-secondary btn-sm pl-1 pr-1 mr-1 mb-0 ${this.data.enabled?"active":""}">
  <input class="noscript-url-scheme" data-component="scheme" type="checkbox" ${new e.tpl.InputChecked(this.data.enabled)} ${new e.tpl.InputDisabled(this.data.disabled)} />${this.data.scheme}://
</label>`:""}},URLRuleSelectorUsername:class extends nano.tpl{html(){return this.data.username.length>0?nano.html`
<label class="btn btn-outline-secondary btn-sm pl-1 pr-1 mr-1 mb-0 ${this.data.enabled?"active":""}">
  <input class="noscript-url-username" data-component="username" type="checkbox" ${new e.tpl.InputChecked(this.data.enabled)} ${new e.tpl.InputDisabled(this.data.disabled)} />${this.data.username}@
</label>`:""}},URLRuleSelectorIP:class extends nano.tpl{html(){return this.data.ip.length>0?nano.html`
<label class="btn btn-outline-secondary btn-sm pl-1 pr-1 mr-1 mb-0 ${this.data.enabled?"active":""}">
  <input class="noscript-url-ip" data-component="ip" type="checkbox" ${new e.tpl.InputChecked(this.data.enabled)} ${new e.tpl.InputDisabled(this.data.disabled)} />${this.data.ip}
</label>`:""}},URLRuleSelectorSubdomain:class extends nano.tpl{html(){return this.data.subdomain.length>0?nano.html`
<label class="btn btn-outline-secondary btn-sm pl-1 pr-1 mr-1 mb-0 ${this.data.enabled?"active":""}">
  <input class="noscript-url-subdomain" data-component="subdomain" type="checkbox" ${new e.tpl.InputChecked(this.data.enabled)} ${new e.tpl.InputDisabled(this.data.disabled)} />${this.data.subdomain}.
</label>`:""}},URLRuleSelectorDomain:class extends nano.tpl{html(){return this.data.domain.length>0?nano.html`
<label class="btn btn-outline-secondary btn-sm pl-1 pr-1 mr-1 mb-0 ${this.data.enabled?"active":""}">
  <input class="noscript-url-domain" data-component="domain" type="checkbox" ${new e.tpl.InputChecked(this.data.enabled)} ${new e.tpl.InputDisabled(this.data.disabled)} />${this.data.domain}
</label>`:""}},URLRuleSelectorHostname:class extends nano.tpl{html(){var t=this.data.url.includes("://")?this.data.url:"://"+this.data.url,n=URI(t);if(n.is("IP")){var s={ip:n.ip(),enabled:this.data["url-components"].indexOf("ip")>=0,disabled:1==this.data["url-components"].length&&this.data["url-components"].indexOf("ip")>=0};return nano.html`${new e.tpl.URLRuleSelectorIP(s)}`}var a={subdomain:n.subdomain(),enabled:this.data["url-components"].indexOf("subdomain")>=0,disabled:1==this.data["url-components"].length&&this.data["url-components"].indexOf("subdomain")>=0},o={domain:n.domain(),enabled:this.data["url-components"].indexOf("subdomain")>=0||this.data["url-components"].indexOf("domain")>=0,disabled:1==this.data["url-components"].length&&this.data["url-components"].indexOf("domain")>=0||this.data["url-components"].indexOf("subdomain")>=0};return nano.html`${new e.tpl.URLRuleSelectorSubdomain(a)}${new e.tpl.URLRuleSelectorDomain(o)}`}},URLRuleSelectorPort:class extends nano.tpl{html(){return this.data.port.length>0?nano.html`
<label class="btn btn-outline-secondary btn-sm pl-1 pr-1 mr-1 mb-0 ${this.data.enabled?"active":""}">
  <input class="noscript-url-port" data-component="port" type="checkbox" ${new e.tpl.InputChecked(this.data.enabled)} ${new e.tpl.InputDisabled(this.data.disabled)} />:${this.data.port}
</label>`:""}},URLRuleSelector:class extends nano.tpl{html(){var t=this.data.url.includes("://")?this.data.url:"://"+this.data.url,n=URI(t),s={scheme:n.scheme(),enabled:this.data["url-components"].indexOf("scheme")>=0,disabled:1==this.data["url-components"].length&&this.data["url-components"].indexOf("scheme")>=0},a={username:n.username(),enabled:this.data["url-components"].indexOf("username")>=0,disabled:1==this.data["url-components"].length&&this.data["url-components"].indexOf("username")>=0},o={port:n.port(),enabled:this.data["url-components"].indexOf("port")>=0,disabled:1==this.data["url-components"].length&&this.data["url-components"].indexOf("port")>=0};return nano.html`
<samp class="btn-group" data-toggle="buttons">
${new e.tpl.URLRuleSelectorScheme(s)}${new e.tpl.URLRuleSelectorUsername(a)}${new e.tpl.URLRuleSelectorHostname(this.data)}${new e.tpl.URLRuleSelectorPort(o)}
</samp>`}},Main:class extends nano.tpl{html(){var t=nano.html`
<header class="row mt-1">
  <div class="col-4 col-md-3 col-lg-3 col-xl-2">
    <button class="btn btn-secondary btn-sm" type="button">Close</button>
  </div>
  <h1 class="col-12 order-2 col-md-6 order-md-1 col-lg-6 col-xl-8 text-center small mt-1"><samp>${this.data["current-url"]}</samp></h1>
  <form class="col-8 order-1 col-md-3 order-md-2 col-lg-3 col-xl-2 text-right" method="get">
    <button class="btn btn-primary btn-sm" type="submit">Reload</button>
    <button class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown" type="button">Settings</button>
  </form>
</header>
            
<main>
`;if(Object.keys(this.data.categories.uncategorised).length>0){var n={url:this.data["current-url"],"url-components":e.session["primary-site-components"]};t+=nano.html`
<div class="card bg-warning mt-3" id="noscript-uncategorised">
  <div class="card-header">
    <div class="row">
      <h3 class="col-12 text-center col-sm-7 text-sm-left ">Uncategorised (Blocked)</h3>
      <div id="noscript-primary-rule" class="col-12 text-center col-sm-5 text-sm-right" data-url="${this.data["current-url"]}" >${new e.tpl.URLRuleSelector(n)}</div>
    </div>
  </div>

  <ul class="list-group list-group-flush">
    ${new e.tpl.UncategorisedItems(this.data)}
  </ul>
</div>
`}for(var s in e.const["access-types"])if(Object.keys(this.data.categories[s]).length>0){var a={"current-url":this.data["current-url"],"access-type":s,style:e.const["access-types"][s].style,urls:this.data.categories[s]};t+=nano.html`
<div class="card bg-${a.style} mt-3 noscript-categorised" data-access="${s}">
  <div class="card-header text-white">
    <div class="noscript-forget-all float-right"><button class="btn btn-secondary btn-sm" type="button">Forget All</button></div>
    <h3>${e.const["access-types"][s].description}</h3>
  </div>

  <ul class="list-group list-group-flush">
    ${new e.tpl.CategorisedItems(a)}
  </ul>
</div>
`}return t+=nano.html`<pre><code>${JSON.stringify(e.config,void 0,2)}</code></pre>`,t+=nano.html`</main>`}}},Run:function(t,n){e.session["current-url"]=t,e.session.resources=n,"primary-site-components"in e.session||(e.session["primary-site-components"]=e.method.GetInitialComponents(t)),"secondary-site-components"in e.session||(e.session["secondary-site-components"]={});var s=e.method.Categorise(t,n);for(var a in s.uncategorised)a in e.session["secondary-site-components"]||(e.session["secondary-site-components"][a]=e.method.GetInitialComponents(a));var o={"current-url":t,categories:s};$("#noscript-main").html(new e.tpl.Main(o).html()),$('#noscript-primary-rule input[type="checkbox"]').change(function(){var t=$(this).data("component"),n=$("#noscript-primary-rule"),s=e.session["primary-site-components"].indexOf(t);if(this.checked){if(-1!=s)return!1;e.session["primary-site-components"].push(t)}else{if(-1==s)return!1;e.session["primary-site-components"].splice(s,1)}var a={url:e.session["current-url"],"url-components":e.session["primary-site-components"]};return n.html(new e.tpl.URLRuleSelector(a).html()),!1}),$('#noscript-uncategorised .noscript-secondary-rule input[type="checkbox"]').change(function(){var t=$(this),n=t.data("component"),s=t.parents(".noscript-secondary-rule"),a=s.data("url"),o=e.session["secondary-site-components"][a].indexOf(n);if(this.checked){if(-1!=o)return!1;e.session["secondary-site-components"][a].push(n)}else{if(-1==o)return!1;e.session["secondary-site-components"][a].splice(o,1)}var r={url:a,"url-components":e.session["secondary-site-components"][a]};return s.html(new e.tpl.URLRuleSelector(r).html()),!1}),$(".noscript-categorised-item .noscript-toolbar button").click(function(){return $("button").attr("disabled","disabled"),!!e.method.ForgetRule(this)&&(e.Run(e.session["current-url"],e.session.resources),!1)}),$(".noscript-categorised .noscript-forget-all button").click(function(){$("button").attr("disabled","disabled");var t=$(this).parents(".noscript-categorised");return $(".noscript-toolbar button",t).each(function(){return!!e.method.ForgetRule(this)}),e.Run(e.session["current-url"],e.session.resources),!1}),$(".noscript-uncategorised-item .noscript-toolbar button").click(function(){$("button").attr("disabled","disabled");var t=$(this),n=t.parents(".noscript-uncategorised-item"),s=t.data("access"),a="allow"===t.data("action"),o=e.config.policy;s in o||(e.config.policy[s]={});var r;switch(s){case"sites":var i=$("#noscript-primary-rule"),l=[];$('input[type="checkbox"]:checked',i).each(function(){var t=$(this);l.push(t.data("component"))});var c=e.method.RuleFromComponents(i.data("url"),l),d=o[s];c in d||(e.config.policy[s][c]={}),r=d[c];var p=$(".noscript-secondary-rule",n),u=[];$('input[type="checkbox"]:checked',p).each(function(){var t=$(this);u.push(t.data("component"))});(h=e.method.RuleFromComponents(p.data("url"),u))in r||(e.config.policy[s][c][h]={});var m=r[h];$('.noscript-types input[type="checkbox"]:not(:disabled):checked',n).each(function(){var t=$(this).data("type");t in m&&console.log("Found unexpected rule for type: "+t),e.config.policy[s][c][h][t]=a});break;case"global":r=o[s];p=$(".noscript-secondary-rule",n),u=[];$('input[type="checkbox"]:checked',p).each(function(){var t=$(this);u.push(t.data("component"))});var h;(h=e.method.RuleFromComponents(p.data("url"),u))in r||(e.config.policy[s][h]={});m=r[h];$('.noscript-types input[type="checkbox"]:not(:disabled):checked',n).each(function(){var t=$(this).data("type");t in m&&console.log("Found unexpected rule for type: "+t),e.config.policy[s][h][t]=a});break;default:console.log("Invalid access type encountered. Got "+s)}return e.Run(e.session["current-url"],e.session.resources),!1})}};"undefined"!=typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:t.NoScriptUI=e}(this);
